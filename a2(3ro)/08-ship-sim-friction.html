<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ship Sim Friction</title>
<style>
#canvas {
background-color: #000000;
display: block;
background-image: url("fondoespacio.jpg");
background-size: 100% 100%;
}
</style>
</head>
<body>
<canvas id="canvas" width="1500" height="790"></canvas>
<aside>Press left and right arrow keys to rotate ship, up to add thrust.</aside>

<script>
function Ship() {
this.x = 0;
this.y = 0;
this.rotation = 0;
this.showFlame = false;

this.image = new Image();
this.image.src = "nave.png";

this.width = 90;
this.height = 60;

this.flame = new Image();
this.flame.src = "flama.png";

this.flameWidth = 80;
this.flameHeight = 40;
}

Ship.prototype.draw = function (context) {
context.save();
context.translate(this.x, this.y);
context.rotate(this.rotation);

context.drawImage(
this.image,
-this.width / 2,
-this.height / 2,
this.width,
this.height
);

if (this.showFlame) {
context.drawImage(
this.flame,
-this.flameWidth / 2,
this.flameheight / 2,
this.flameWidth,
this.flameHeight
);
}

context.restore();
};

window.onload = function () {
var canvas = document.getElementById('canvas'),
context = canvas.getContext('2d'),
ship = new Ship(),
vr = 0,
vx = 0,
vy = 0,
thrust = 0,
friction = 0.97;

ship.x = canvas.width / 2;
ship.y = canvas.height / 2;

window.addEventListener('keydown', function (event) {
switch (event.keyCode) {
case 37:
vr = -3;
break;
case 39:
vr = 3;
break;
case 38:
thrust = 0.1;
ship.showFlame = true;
break;
}
}, false);

window.addEventListener('keyup', function () {
vr = 0;
thrust = 0;
ship.showFlame = false;
}, false);

(function drawFrame() {
window.requestAnimationFrame(drawFrame, canvas);
context.clearRect(0, 0, canvas.width, canvas.height);

ship.rotation += vr * Math.PI / 180;
var angle = ship.rotation,
ax = Math.cos(angle) * thrust,
ay = Math.sin(angle) * thrust,
left = 0,
right = canvas.width,
top = 0,
bottom = canvas.height;

vx += ax;
vy += ay;
vx *= friction;
vy *= friction;
ship.x += vx;
ship.y += vy;

if (ship.x - ship.width / 2 > right) {
ship.x = left - ship.width / 2;
} else if (ship.x + ship.width / 2 < left) {
ship.x = right + ship.width / 2;
}
if (ship.y - ship.height / 2 > bottom) {
ship.y = top - ship.height / 2;
} else if (ship.y < top - ship.height / 2) {
ship.y = bottom + ship.height / 2;
}

ship.draw(context);
}());
};
</script>
</body>
</html>